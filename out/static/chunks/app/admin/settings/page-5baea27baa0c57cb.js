(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6140],{67313:function(e,t,r){Promise.resolve().then(r.bind(r,8307))},8307:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(57437),s=r(2265),i=r(66070),a=r(62869),o=r(95186),l=r(26815),d=r(12339),c=r(65613),u=r(35153),f=r(80605);let m=["inventory","accounting","shipping","notifications","general"];function g(e){let{settings:t,loading:r,onEdit:s,onDelete:i}=e;return r?(0,n.jsx)("div",{role:"status","aria-live":"polite",children:"Loading..."}):t.length?(0,n.jsxs)("table",{className:"w-full text-sm mb-4",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"text-left",children:"Key"}),(0,n.jsx)("th",{className:"text-left",children:"Value"}),(0,n.jsx)("th",{className:"text-left",children:"Description"}),(0,n.jsx)("th",{className:"text-left",children:"Updated"}),(0,n.jsx)("th",{})]})}),(0,n.jsx)("tbody",{children:t.map(e=>(0,n.jsxs)("tr",{className:"border-b last:border-0",children:[(0,n.jsx)("td",{children:e.key}),(0,n.jsx)("td",{children:e.value}),(0,n.jsx)("td",{children:e.description}),(0,n.jsx)("td",{children:new Date(e.updatedAt).toLocaleString()}),(0,n.jsxs)("td",{children:[(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>s(e),className:"mr-2",children:"Edit"}),(0,n.jsx)(a.z,{size:"sm",variant:"destructive",onClick:()=>i(e.key),children:"Delete"})]})]},e.key))})]}):(0,n.jsx)("div",{className:"text-muted-foreground",children:"No settings found for this category."})}function h(e){let{form:t,onChange:r,onSubmit:i,editingKey:d,onCancel:u,error:f,loading:m,autoFocusKey:g,autoFocusValue:h}=e,p=(0,s.useRef)(null),x=(0,s.useRef)(null),v=(0,s.useRef)(null);return(0,s.useEffect)(()=>{f&&p.current&&p.current.focus()},[f]),(0,s.useEffect)(()=>{g&&x.current&&x.current.focus(),h&&v.current&&v.current.focus()},[g,h,d]),(0,n.jsxs)("form",{onSubmit:i,className:"space-y-3 bg-muted p-4 rounded-lg","aria-label":"Settings form",children:[(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)(l.Label,{htmlFor:"key",children:"Key"}),(0,n.jsx)(o.I,{id:"key",name:"key",value:t.key,onChange:r,disabled:!!d,required:!0,"aria-required":"true",ref:x,autoFocus:g})]}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)(l.Label,{htmlFor:"value",children:"Value"}),(0,n.jsx)(o.I,{id:"value",name:"value",value:t.value,onChange:r,required:!0,"aria-required":"true",ref:v,autoFocus:h})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(l.Label,{htmlFor:"description",children:"Description"}),(0,n.jsx)(o.I,{id:"description",name:"description",value:t.description,onChange:r})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)(a.z,{type:"submit",size:"sm",disabled:m,"aria-busy":m,children:[d?"Update":"Add"," Setting"]}),d&&(0,n.jsx)(a.z,{type:"button",size:"sm",variant:"outline",onClick:u,children:"Cancel"})]}),f&&(0,n.jsx)(c.bZ,{variant:"destructive",tabIndex:-1,ref:p,"aria-live":"assertive",children:(0,n.jsx)(c.X,{children:f})})]})}function p(){var e;let{data:t}=(0,f.useSession)(),r=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.role,[o,l]=(0,s.useState)([]),[c,p]=(0,s.useState)("inventory"),[x,v]=(0,s.useState)(!0),[b,y]=(0,s.useState)(""),[j,N]=(0,s.useState)({key:"",value:"",category:"inventory",description:""}),[w,S]=(0,s.useState)(null),[A,k]=(0,s.useState)(0);async function E(){v(!0),y("");try{let e=await fetch("/api/admin/settings");if(!e.ok){if(403===e.status)throw Error("You are not authorized to view settings.");throw Error("Failed to fetch settings")}let t=await e.json();l(t)}catch(e){y(e.message||"Could not load settings.")}finally{v(!1)}}function T(e){N({...j,[e.target.name]:e.target.value})}function C(e){S(e.key),N({key:e.key,value:e.value,category:e.category,description:e.description||""})}function R(){S(null),N({key:"",value:"",category:c,description:""})}async function _(e){if(e.preventDefault(),y(""),!j.key||!j.value||!j.category){y("Key, value, and category are required.");return}try{let e=await fetch("/api/admin/settings",{method:w?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to save setting")}(0,u.Am)({title:"Setting saved"}),await E(),R()}catch(e){y(e.message||"Failed to save setting.")}}async function D(e){if(window.confirm("Are you sure you want to delete this setting?"))try{let t=await fetch("/api/admin/settings",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to delete setting")}(0,u.Am)({title:"Setting deleted"}),await E()}catch(e){y(e.message||"Failed to delete setting.")}}(0,s.useEffect)(()=>{E()},[A]);let I=m.reduce((e,t)=>(e[t]=o.filter(e=>e.category===t),e),{});return(0,n.jsx)("div",{className:"max-w-3xl mx-auto py-10",children:(0,n.jsxs)(i.Zb,{children:[(0,n.jsx)(i.Ol,{children:(0,n.jsx)(i.ll,{children:"Admin Settings"})}),(0,n.jsx)(i.aY,{children:(0,n.jsxs)(d.mQ,{value:c,onValueChange:p,className:"mb-6",children:[(0,n.jsx)(d.dr,{children:m.map(e=>(0,n.jsx)(d.SP,{value:e,className:"capitalize",children:e},e))}),m.map(e=>(0,n.jsxs)(d.nU,{value:e,children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("h3",{className:"font-semibold mb-2",id:"settings-".concat(e),children:[e.charAt(0).toUpperCase()+e.slice(1)," Settings"]}),(0,n.jsx)(g,{settings:I[e]||[],loading:x,onEdit:C,onDelete:D}),!x&&0===(I[e]||[]).length&&(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 text-blue-900 rounded-lg p-4 mt-4",children:[(0,n.jsx)("div",{className:"font-semibold mb-1",children:"Welcome to Settings!"}),(0,n.jsxs)("div",{className:"text-sm",children:["SUPER_ADMIN"===r&&(0,n.jsxs)(n.Fragment,{children:["As a ",(0,n.jsx)("b",{children:"Super Admin"}),", you can configure global settings for inventory, accounting, shipping, and more. Use the form below to add your first setting. ",(0,n.jsx)("br",{}),"Need help? See the admin guide or contact support."]}),"FINANCIAL_MANAGER"===r&&(0,n.jsxs)(n.Fragment,{children:["As a ",(0,n.jsx)("b",{children:"Financial Manager"}),", you can manage accounting and notification settings. Use the form below to add your first setting. ",(0,n.jsx)("br",{}),"Need help? See the admin guide or contact support."]}),!r&&(0,n.jsxs)(n.Fragment,{children:["Use the form below to add your first setting. ",(0,n.jsx)("br",{}),"Need help? See the admin guide or contact support."]})]})]})]}),(0,n.jsx)(h,{form:{...j,category:e},onChange:T,onSubmit:_,editingKey:w,onCancel:R,error:b,loading:x,autoFocusKey:!w,autoFocusValue:!!w}),b&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>k(e=>e+1),children:"Retry"})})]},e))]})})]})})}},65613:function(e,t,r){"use strict";r.d(t,{X:function(){return d},bZ:function(){return l}});var n=r(57437),s=r(2265),i=r(77712),a=r(94508);let o=(0,i.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),l=s.forwardRef((e,t)=>{let{className:r,variant:s,...i}=e;return(0,n.jsx)("div",{ref:t,role:"alert",className:(0,a.cn)(o({variant:s}),r),...i})});l.displayName="Alert",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h5",{ref:t,className:(0,a.cn)("mb-1 font-medium leading-none tracking-tight",r),...s})}).displayName="AlertTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-sm [&_p]:leading-relaxed",r),...s})});d.displayName="AlertDescription"},62869:function(e,t,r){"use strict";r.d(t,{d:function(){return l},z:function(){return d}});var n=r(57437),s=r(2265),i=r(37053),a=r(77712),o=r(94508);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:a,asChild:d=!1,...c}=e,u=d?i.g7:"button";return(0,n.jsx)(u,{className:(0,o.cn)(l({variant:s,size:a,className:r})),ref:t,...c})});d.displayName="Button"},66070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return a},aY:function(){return c},ll:function(){return l}});var n=r(57437),s=r(2265),i=r(94508);let a=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});a.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},95186:function(e,t,r){"use strict";r.d(t,{I:function(){return a}});var n=r(57437),s=r(2265),i=r(94508);let a=s.forwardRef((e,t)=>{let{className:r,type:s,...a}=e;return(0,n.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});a.displayName="Input"},26815:function(e,t,r){"use strict";r.d(t,{Label:function(){return d}});var n=r(57437),s=r(2265),i=r(6394),a=r(77712),o=r(94508);let l=(0,a.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(i.f,{ref:t,className:(0,o.cn)(l(),r),...s})});d.displayName=i.f.displayName},12339:function(e,t,r){"use strict";r.d(t,{SP:function(){return d},dr:function(){return l},mQ:function(){return o},nU:function(){return c}});var n=r(57437),s=r(2265),i=r(20271),a=r(94508);let o=i.fC,l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(i.aV,{ref:t,className:(0,a.cn)("flex flex-col w-full gap-1 text-muted-foreground",r),...s})});l.displayName=i.aV.displayName;let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(i.xz,{ref:t,className:(0,a.cn)("flex items-center w-full text-left gap-3 px-4 py-2.5 text-base font-medium rounded-md transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:font-bold data-[state=active]:border-l-4 data-[state=active]:border-primary",r),...s})});d.displayName=i.xz.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(i.VY,{ref:t,className:(0,a.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s})});c.displayName=i.VY.displayName},35153:function(e,t,r){"use strict";r.d(t,{Am:function(){return u},pm:function(){return f}});var n=r(2265);let s=0,i=new Map,a=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?a(r):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],d={toasts:[]};function c(e){d=o(d,e),l.forEach(e=>{e(d)})}function u(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||n()}}}),{id:r,dismiss:n,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=n.useState(d);return n.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},32507:function(e,t,r){"use strict";r.d(t,{_:function(){return a}});var n,s=r(93340),i=r(40257);let a=null!==(n=globalThis.prisma)&&void 0!==n?n:new s.PrismaClient({log:["error"],datasources:{db:{url:i.env.DATABASE_URL}}});i.on("beforeExit",async()=>{await a.$disconnect()})},94508:function(e,t,r){"use strict";r.d(t,{Bp:function(){return a},cn:function(){return i}});var n=r(61994),s=r(53335);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}function a(e,t){if(e===t)return 0;if(!e.length)return t.length;if(!t.length)return e.length;let r=Array.from({length:e.length+1},()=>Array(t.length+1).fill(0));for(let t=0;t<=e.length;t++)r[t][0]=t;for(let e=0;e<=t.length;e++)r[0][e]=e;for(let n=1;n<=e.length;n++)for(let s=1;s<=t.length;s++){let i=e[n-1]===t[s-1]?0:1;r[n][s]=Math.min(r[n-1][s]+1,r[n][s-1]+1,r[n-1][s-1]+i)}return r[e.length][t.length]}r(32507)}},function(e){e.O(0,[2981,605,429,2971,2117,1744],function(){return e(e.s=67313)}),_N_E=e.O()}]);