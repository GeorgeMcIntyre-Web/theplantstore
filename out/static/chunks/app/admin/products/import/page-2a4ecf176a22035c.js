(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3323],{26935:function(e,t,s){Promise.resolve().then(s.bind(s,38709))},38709:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var n=s(57437),a=s(2265),r=s(62869),l=s(95186),o=s(15452),i=s.n(o),c=s(94508),d=s(99376),u=s(12);function m(){let[e,t]=(0,a.useState)(null),[s,o]=(0,a.useState)([]),[m,f]=(0,a.useState)([]),[p,h]=(0,a.useState)([]),[g,x]=(0,a.useState)(!1),[b,v]=(0,a.useState)({}),[j,N]=(0,a.useState)(!1),[w,y]=(0,a.useState)(null),k=(0,d.useRouter)(),S=async()=>{N(!0),y(null);try{let s=new FormData;e&&s.append("file",e);let n=new Set;m.forEach(e=>{e.imageFile&&!n.has(e.imageFile.name)&&(s.append("images",e.imageFile),n.add(e.imageFile.name))});let a=await fetch("/api/admin/import/products",{method:"POST",body:s}),r=await a.json();if(!a.ok)throw Error(r.error||"Import failed");y({success:!0,created:r.created,updated:r.updated,failed:r.failed,errors:r.errors||[],updateNotes:r.updateNotes||[]}),t(null),o([]),f([]),v({})}catch(e){y({success:!1,error:e.message})}N(!1)};return(0,n.jsxs)("div",{className:"w-full flex flex-col items-center justify-center p-8",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Import Products"}),(0,n.jsxs)("div",{className:"flex flex-col gap-4 max-w-xl",children:[(0,n.jsxs)("label",{className:"font-medium",children:["CSV File",(0,n.jsx)(l.I,{type:"file",accept:".csv",onChange:e=>{e.target.files&&e.target.files[0]&&t(e.target.files[0])}})]}),(0,n.jsxs)("label",{className:"font-medium",children:["Product Images (PNG/JPG, multiple allowed)",(0,n.jsx)(l.I,{type:"file",accept:"image/png,image/jpeg",multiple:!0,onChange:e=>{e.target.files&&o(Array.from(e.target.files))}})]}),(0,n.jsx)(r.z,{onClick:()=>{x(!0),h([]),e&&i().parse(e,{header:!0,skipEmptyLines:!0,complete:e=>{let t=e.data,n=new Set,a=[],r=[];t.forEach((e,t)=>{let l=b[e.sku],o=l?l.name:null,i=!1,d="Manual";if(!l){let t=function(e,t){if(!t.length)return{file:null,name:null};let s=e=>e.toLowerCase().replace(/[^a-z0-9]/g,""),n=[e.sku,e.slug,e.name].filter(Boolean).map(s);for(let e of t){let t=s(e.name.replace(/\.[^.]+$/,""));if(n.includes(t))return{file:e,name:e.name,reason:"Exact match"}}for(let e of t){let t=s(e.name.replace(/\.[^.]+$/,""));if(n.some(e=>t.startsWith(e)||t.includes(e)))return{file:e,name:e.name,reason:"Partial match"}}for(let e of t){let t=s(e.name.replace(/\.[^.]+$/,"")).split(/[-_ ]/);if(n.some(e=>t.includes(e)))return{file:e,name:e.name,reason:"Token match"}}let a=null,r=null,l=1/0,o=[];for(let e of t){let t=s(e.name.replace(/\.[^.]+$/,""));for(let s of n){let n=(0,c.Bp)(t,s);n<l?(l=n,a=e,r=e.name,o=[e]):n===l&&o.push(e)}}return l<=2?{file:a,name:r,ambiguous:o.length>1,reason:"Fuzzy match"}:{file:null,name:null,reason:"No match"}}(e,s);l=t.file||void 0,o=t.name,i=!!t.ambiguous,d=t.reason||""}let u="Ready";e.sku?n.has(e.sku)?(u="Duplicate SKU",r.push("Row ".concat(t+2,": Duplicate SKU ").concat(e.sku))):n.add(e.sku):(u="Missing SKU",r.push("Row ".concat(t+2,": Missing SKU"))),l||(u="Missing Image",r.push("Row ".concat(t+2,": No matching image for ").concat(e.name||e.slug||e.sku))),a.push({...e,imageMatch:o,imageFile:l,ambiguous:i,matchReason:d,status:u})}),f(a),h(r),x(!1)},error:e=>{h([e.message]),x(!1)}})},disabled:!e||0===s.length||g,children:g?"Processing...":"Preview Import"})]}),(0,n.jsxs)("div",{className:"mt-8",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Preview"}),p.length>0&&(0,n.jsxs)("div",{className:"mb-4 text-red-600",children:[p.map((e,t)=>(0,n.jsx)("div",{children:e},t)),(0,n.jsx)(r.z,{className:"mt-2",variant:"outline",onClick:()=>{let e=new Blob([["Error"].concat(p).join("\n")],{type:"text/csv;charset=utf-8;"});(0,u.saveAs)(e,"import-errors.csv")},children:"Download Errors as CSV"})]}),w&&w.success?null:m.length>0?(0,n.jsx)("div",{className:"overflow-x-auto w-full",children:(0,n.jsxs)("table",{className:"min-w-full border text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"p-2",children:"Name"}),(0,n.jsx)("th",{className:"p-2",children:"SKU"}),(0,n.jsx)("th",{className:"p-2",children:"Slug"}),(0,n.jsx)("th",{className:"p-2",children:"Category"}),(0,n.jsx)("th",{className:"p-2",children:"Price"}),(0,n.jsx)("th",{className:"p-2",children:"Stock"}),(0,n.jsx)("th",{className:"p-2",children:"isActive"}),(0,n.jsx)("th",{className:"p-2",children:"isFeatured"}),(0,n.jsx)("th",{className:"p-2",children:"Image"}),(0,n.jsx)("th",{className:"p-2",children:"Status"}),(0,n.jsx)("th",{className:"p-2",children:"Errors/Warnings"})]})}),(0,n.jsx)("tbody",{children:m.map((e,t)=>(0,n.jsxs)("tr",{className:"Ready"!==e.status?"bg-red-50":e.ambiguous?"bg-yellow-50":"",children:[(0,n.jsx)("td",{className:"p-2",children:e.name}),(0,n.jsx)("td",{className:"p-2",children:e.sku}),(0,n.jsx)("td",{className:"p-2",children:e.slug}),(0,n.jsx)("td",{className:"p-2",children:e.category}),(0,n.jsx)("td",{className:"p-2",children:e.price}),(0,n.jsx)("td",{className:"p-2",children:e.stockQuantity}),(0,n.jsx)("td",{className:"p-2",children:e.isActive?"Yes":"No"}),(0,n.jsx)("td",{className:"p-2",children:e.isFeatured?"Yes":"No"}),(0,n.jsx)("td",{className:"p-2",children:e.imageFile?(0,n.jsx)("img",{src:URL.createObjectURL(e.imageFile),alt:e.name,className:"h-10 w-10 object-contain inline-block mr-2"}):(0,n.jsx)("span",{className:"text-red-600",children:"No match"})}),(0,n.jsx)("td",{className:"p-2",children:e.status}),(0,n.jsxs)("td",{className:"p-2",children:["Ready"!==e.status&&(0,n.jsxs)("span",{className:"text-red-600",title:e.status,children:["⚠️ ",e.status]}),e.ambiguous&&(0,n.jsx)("span",{className:"text-yellow-700 ml-2",title:"Ambiguous image match",children:"⚠️ Ambiguous"})]})]},t))})]})}):(0,n.jsx)("div",{className:"text-muted-foreground",children:"No preview data yet. Upload CSV and images, then click Preview."}),(0,n.jsx)(r.z,{className:"mt-6",disabled:0===m.length||p.length>0||j||w&&w.success,onClick:S,children:j?"Importing...":"Import Products"}),j&&(0,n.jsx)("div",{className:"mt-4 text-blue-600",children:"Importing products..."}),w&&w.success&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("div",{className:"text-green-600 font-semibold text-lg mb-2",children:"Import complete!"}),(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Created:"})," ",w.created," \xa0|",(0,n.jsx)("span",{className:"font-semibold",children:" Updated:"})," ",w.updated," \xa0|",(0,n.jsx)("span",{className:"font-semibold",children:" Failed:"})," ",w.failed]}),w.updateNotes&&w.updateNotes.length>0&&(0,n.jsxs)("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-2",children:[(0,n.jsx)("div",{className:"font-semibold mb-1",children:"Update Notes:"}),(0,n.jsx)("ul",{className:"list-disc pl-5",children:w.updateNotes.map((e,t)=>(0,n.jsx)("li",{children:e},t))})]}),w.errors&&w.errors.length>0&&(0,n.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-2",children:[(0,n.jsx)("div",{className:"font-semibold mb-1",children:"Import Errors:"}),(0,n.jsx)("ul",{className:"list-disc pl-5",children:w.errors.map((e,t)=>(0,n.jsx)("li",{children:e},t))})]})]}),w&&!w.success&&(0,n.jsxs)("div",{className:"mt-4 text-red-600",children:["Import failed: ",w.error]}),(0,n.jsx)(r.z,{size:"lg",className:"mt-8 w-full bg-green-600 hover:bg-green-700 text-white text-lg font-bold py-4",onClick:()=>k.back(),children:"← Back"})]})]})}},62869:function(e,t,s){"use strict";s.d(t,{d:function(){return i},z:function(){return c}});var n=s(57437),a=s(2265),r=s(37053),l=s(77712),o=s(94508);let i=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:s,variant:a,size:l,asChild:c=!1,...d}=e,u=c?r.g7:"button";return(0,n.jsx)(u,{className:(0,o.cn)(i({variant:a,size:l,className:s})),ref:t,...d})});c.displayName="Button"},95186:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var n=s(57437),a=s(2265),r=s(94508);let l=a.forwardRef((e,t)=>{let{className:s,type:a,...l}=e;return(0,n.jsx)("input",{type:a,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})});l.displayName="Input"},32507:function(e,t,s){"use strict";s.d(t,{_:function(){return l}});var n,a=s(93340),r=s(40257);let l=null!==(n=globalThis.prisma)&&void 0!==n?n:new a.PrismaClient({log:["error"],datasources:{db:{url:r.env.DATABASE_URL}}});r.on("beforeExit",async()=>{await l.$disconnect()})},94508:function(e,t,s){"use strict";s.d(t,{Bp:function(){return l},cn:function(){return r}});var n=s(61994),a=s(53335);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,n.W)(t))}function l(e,t){if(e===t)return 0;if(!e.length)return t.length;if(!t.length)return e.length;let s=Array.from({length:e.length+1},()=>Array(t.length+1).fill(0));for(let t=0;t<=e.length;t++)s[t][0]=t;for(let e=0;e<=t.length;e++)s[0][e]=e;for(let n=1;n<=e.length;n++)for(let a=1;a<=t.length;a++){let r=e[n-1]===t[a-1]?0:1;s[n][a]=Math.min(s[n-1][a]+1,s[n][a-1]+1,s[n-1][a-1]+r)}return s[e.length][t.length]}s(32507)},12:function(e,t,s){var n,a,r;a=[],void 0!==(r="function"==typeof(n=function(){"use strict";function t(e,t,s){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){o(n.response,t,s)},n.onerror=function(){console.error("could not download file")},n.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(s){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,l=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(e,s,l){var o=r.URL||r.webkitURL,i=document.createElement("a");s=s||e.name||"download",i.download=s,i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?a(i):n(i.href)?t(e,s,l):a(i,i.target="_blank")):(i.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(i.href)},4e4),setTimeout(function(){a(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,s,r){if(s=s||e.name||"download","string"!=typeof e){var l;navigator.msSaveOrOpenBlob((void 0===(l=r)?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e),s)}else if(n(e))t(e,s,r);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){a(o)})}}:function(e,s,n,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,s,n);var o="application/octet-stream"===e.type,i=/constructor/i.test(r.HTMLElement)||r.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||o&&i||l)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},d.readAsDataURL(e)}else{var u=r.URL||r.webkitURL,m=u.createObjectURL(e);a?a.location=m:location.href=m,a=null,setTimeout(function(){u.revokeObjectURL(m)},4e4)}});r.saveAs=o.saveAs=o,e.exports=o})?n.apply(t,a):n)&&(e.exports=r)},99376:function(e,t,s){"use strict";var n=s(35475);s.o(n,"notFound")&&s.d(t,{notFound:function(){return n.notFound}}),s.o(n,"useParams")&&s.d(t,{useParams:function(){return n.useParams}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[2981,5907,2971,2117,1744],function(){return e(e.s=26935)}),_N_E=e.O()}]);