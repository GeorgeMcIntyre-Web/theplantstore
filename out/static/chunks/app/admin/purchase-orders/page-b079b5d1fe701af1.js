(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6623],{84893:function(e,t,r){Promise.resolve().then(r.bind(r,33777))},33777:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var n=r(57437),s=r(80605),a=r(2265),i=r(27648),l=r(62869),o=r(99376),c=r(32660);let d=0,u=new Map,h=e=>{if(u.has(e))return;let t=setTimeout(()=>{u.delete(e),x({type:"REMOVE_TOAST",toastId:e})},1e6);u.set(e,t)},f=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?h(r):e.toasts.forEach(e=>{h(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},p=[],m={toasts:[]};function x(e){m=f(m,e),p.forEach(e=>{e(m)})}function v(e){let{...t}=e,r=(d=(d+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>x({type:"DISMISS_TOAST",toastId:r});return x({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||n()}}}),{id:r,dismiss:n,update:e=>x({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function g(){var e;let{data:t}=(0,s.useSession)(),[r,d]=(0,a.useState)([]),[u,h]=(0,a.useState)(!0),[f,g]=(0,a.useState)(null),[y,j]=(0,a.useState)([]),[b,N]=(0,a.useState)({}),[S,C]=(0,a.useState)(1),[w,A]=(0,a.useState)(!1),[k,T]=(0,a.useState)([]),[O,E]=(0,a.useState)(""),[z,P]=(0,a.useState)(!1),I=(0,o.useRouter)(),R=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id,{toast:_}=function(){let[e,t]=a.useState(m);return a.useEffect(()=>(p.push(t),()=>{let e=p.indexOf(t);e>-1&&p.splice(e,1)}),[e]),{...e,toast:v,dismiss:e=>x({type:"DISMISS_TOAST",toastId:e})}}();(0,a.useEffect)(()=>{R&&(h(!0),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e)).finally(()=>h(!1)),fetch("/api/admin/suppliers").then(e=>e.json()).then(e=>T(e)))},[R]);let D=async e=>{g(e),await fetch("/api/admin/purchase-orders",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,adminId:R})}),g(null),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e))},F=(e,t)=>{j(r=>t?[...r,e]:r.filter(t=>t!==e))},q=e=>{j(e?r.map(e=>e.id):[])},B=(e,t)=>{N(r=>({...r,[e]:t}))},L=async e=>{let t=b[e.id];t&&!(t<1)&&(await fetch("/api/admin/purchase-orders/".concat(e.id,"/quantity"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:t})}),N(t=>{let r={...t};return delete r[e.id],r}),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e)))},M=async()=>{for(let e of y)await fetch("/api/admin/purchase-orders/".concat(e,"/quantity"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:S})});A(!1),C(1),j([]),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e))},V=async()=>{for(let e of y)await fetch("/api/admin/purchase-orders",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,adminId:R})});j([]),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e))},J=async()=>{for(let e of y)await fetch("/api/admin/purchase-orders/".concat(e,"/supplier"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({supplierId:O})});P(!1),E(""),j([]),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e))},W=async()=>{if(R)try{let e=await fetch("/api/admin/purchase-orders/auto-draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:R})}),t=await e.json();e.ok?(_({title:"Created ".concat(t.created," auto-draft purchase order(s).")}),h(!0),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e)).finally(()=>h(!1))):_({title:"Error",description:t.error||"Failed to generate purchase orders.",variant:"destructive"})}catch(e){_({title:"Error",description:"Failed to generate purchase orders.",variant:"destructive"})}},H=async()=>{if(R&&0!==y.length)try{let e=await fetch("/api/admin/purchase-orders/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:R,poIds:y})}),t=await e.json();e.ok?(_({title:"Deleted ".concat(t.deleted," draft purchase order(s).")}),j([]),h(!0),fetch("/api/admin/purchase-orders?adminId=".concat(R)).then(e=>e.json()).then(e=>d(e)).finally(()=>h(!1))):_({title:"Error",description:t.error||"Failed to delete purchase orders.",variant:"destructive"})}catch(e){_({title:"Error",description:"Failed to delete purchase orders.",variant:"destructive"})}};return(0,n.jsxs)("div",{className:"w-full h-full flex flex-col p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,n.jsxs)("button",{onClick:()=>{window.history.length>1?I.back():I.push("/admin")},className:"flex items-center text-primary hover:underline",children:[(0,n.jsx)(c.Z,{className:"w-4 h-4 mr-1"}),"Back"]}),(0,n.jsx)("h1",{className:"text-2xl font-bold ml-2",children:"Purchase Orders"}),r.length>0&&(0,n.jsx)(l.z,{className:"ml-auto",variant:"outline",onClick:W,children:"Generate Purchase Orders for Low Stock"})]}),y.length>0&&(0,n.jsxs)("div",{className:"mb-4 flex gap-4 items-center bg-accent p-3 rounded",children:[(0,n.jsxs)("span",{children:[y.length," selected"]}),(0,n.jsx)(l.z,{size:"sm",onClick:()=>A(!0),children:"Batch Update Quantity"}),(0,n.jsx)(l.z,{size:"sm",onClick:()=>P(!0),children:"Batch Update Supplier"}),(0,n.jsx)(l.z,{size:"sm",onClick:V,children:"Batch Approve"}),(0,n.jsx)(l.z,{size:"sm",variant:"destructive",onClick:H,children:"Delete Selected"})]}),w&&(0,n.jsxs)("div",{className:"mb-4 flex gap-2 items-center bg-muted p-3 rounded",children:[(0,n.jsxs)("span",{children:["Set quantity for ",y.length," selected POs:"]}),(0,n.jsx)("input",{type:"number",min:1,value:S,onChange:e=>C(Number(e.target.value)),className:"border p-1 w-20"}),(0,n.jsx)(l.z,{size:"sm",onClick:M,children:"Save"}),(0,n.jsx)(l.z,{size:"sm",variant:"ghost",onClick:()=>A(!1),children:"Cancel"})]}),z&&(0,n.jsxs)("div",{className:"mb-4 flex gap-2 items-center bg-muted p-3 rounded",children:[(0,n.jsxs)("span",{children:["Set supplier for ",y.length," selected POs:"]}),(0,n.jsxs)("select",{className:"border p-1 rounded",value:O,onChange:e=>E(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Select supplier..."}),k.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsx)(l.z,{size:"sm",onClick:J,disabled:!O,children:"Save"}),(0,n.jsx)(l.z,{size:"sm",variant:"ghost",onClick:()=>P(!1),children:"Cancel"})]}),u?(0,n.jsx)("div",{children:"Loading..."}):0===r.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,n.jsx)("div",{className:"text-lg mb-4",children:"No purchase orders found."}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)(l.z,{onClick:W,children:"Generate Purchase Orders for Low Stock"})}),(0,n.jsx)(i.default,{href:"/admin/purchase-orders/new",children:(0,n.jsx)(l.z,{variant:"secondary",children:"Create Purchase Order"})})]}):(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full border",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"p-2",children:(0,n.jsx)("input",{type:"checkbox",checked:y.length===r.length,onChange:e=>q(e.target.checked)})}),(0,n.jsx)("th",{className:"p-2 text-left",children:"PO Number"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"Status"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"Supplier"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"Product"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"Amount Required"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"Total"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"Created"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"Actions"})]})}),(0,n.jsx)("tbody",{children:r.map(e=>{var t,r;let s=y.includes(e.id),a="DRAFT"===e.status,o=Array.isArray(e.items)?e.items[0]:null;return(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("td",{className:"p-2",children:(0,n.jsx)("input",{type:"checkbox",checked:s,onChange:t=>F(e.id,t.target.checked)})}),(0,n.jsx)("td",{className:"p-2 font-mono",children:e.orderNumber}),(0,n.jsx)("td",{className:"p-2",children:e.status}),(0,n.jsx)("td",{className:"p-2",children:(null===(t=e.supplier)||void 0===t?void 0:t.name)||"-"}),(0,n.jsx)("td",{className:"p-2",children:(null==o?void 0:o.name)||"-"}),(0,n.jsx)("td",{className:"p-2",children:a&&o?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"number",min:1,value:null!==(r=b[e.id])&&void 0!==r?r:o.quantity,onChange:t=>B(e.id,Number(t.target.value)),className:"border p-1 w-20"}),(0,n.jsx)(l.z,{size:"sm",onClick:()=>L(e),disabled:!b[e.id]||b[e.id]===o.quantity,children:"Save"})]}):o?o.quantity:"-"}),(0,n.jsxs)("td",{className:"p-2",children:["R",Number(e.total).toFixed(2)]}),(0,n.jsx)("td",{className:"p-2",children:new Date(e.createdAt).toLocaleString()}),(0,n.jsxs)("td",{className:"p-2 space-x-2",children:[(0,n.jsx)(i.default,{href:"/admin/purchase-orders/".concat(e.id),className:"underline text-blue-600",children:"View"}),a&&(0,n.jsx)(l.z,{size:"sm",onClick:()=>D(e.id),disabled:f===e.id,children:f===e.id?"Approving...":"Approve"})]})]},e.id)})})]})})]})}},62869:function(e,t,r){"use strict";r.d(t,{d:function(){return o},z:function(){return c}});var n=r(57437),s=r(2265),a=r(37053),i=r(77712),l=r(94508);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(o({variant:s,size:i,className:r})),ref:t,...d})});c.displayName="Button"},32507:function(e,t,r){"use strict";r.d(t,{_:function(){return i}});var n,s=r(93340),a=r(40257);let i=null!==(n=globalThis.prisma)&&void 0!==n?n:new s.PrismaClient({log:["error"],datasources:{db:{url:a.env.DATABASE_URL}}});a.on("beforeExit",async()=>{await i.$disconnect()})},94508:function(e,t,r){"use strict";r.d(t,{Bp:function(){return i},cn:function(){return a}});var n=r(61994),s=r(53335);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}function i(e,t){if(e===t)return 0;if(!e.length)return t.length;if(!t.length)return e.length;let r=Array.from({length:e.length+1},()=>Array(t.length+1).fill(0));for(let t=0;t<=e.length;t++)r[t][0]=t;for(let e=0;e<=t.length;e++)r[0][e]=e;for(let n=1;n<=e.length;n++)for(let s=1;s<=t.length;s++){let a=e[n-1]===t[s-1]?0:1;r[n][s]=Math.min(r[n-1][s]+1,r[n][s-1]+1,r[n-1][s-1]+a)}return r[e.length][t.length]}r(32507)},79205:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...h}=e;return(0,n.createElement)("svg",{ref:t,...i,width:s,height:s,stroke:r,strokeWidth:o?24*Number(l)/Number(s):l,className:a("lucide",c),...h},[...u.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),o=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:o,...c}=r;return(0,n.createElement)(l,{ref:i,iconNode:t,className:a("lucide-".concat(s(e)),o),...c})});return r.displayName="".concat(e),r}},32660:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(79205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},27648:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(72972),s=r.n(n)},99376:function(e,t,r){"use strict";var n=r(35475);r.o(n,"notFound")&&r.d(t,{notFound:function(){return n.notFound}}),r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},98575:function(e,t,r){"use strict";r.d(t,{F:function(){return s},e:function(){return a}});var n=r(2265);function s(...e){return t=>e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}function a(...e){return n.useCallback(s(...e),e)}},37053:function(e,t,r){"use strict";r.d(t,{A4:function(){return o},g7:function(){return i}});var n=r(2265),s=r(98575),a=r(57437),i=n.forwardRef((e,t)=>{let{children:r,...s}=e,i=n.Children.toArray(r),o=i.find(c);if(o){let e=o.props.children,r=i.map(t=>t!==o?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(l,{...s,ref:t,children:n.isValidElement(e)?n.cloneElement(e,void 0,r):null})}return(0,a.jsx)(l,{...s,ref:t,children:r})});i.displayName="Slot";var l=n.forwardRef((e,t)=>{let{children:r,...a}=e;if(n.isValidElement(r)){let e,i;let l=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref;return n.cloneElement(r,{...function(e,t){let r={...t};for(let n in t){let s=e[n],a=t[n];/^on[A-Z]/.test(n)?s&&a?r[n]=(...e)=>{a(...e),s(...e)}:s&&(r[n]=s):"style"===n?r[n]={...s,...a}:"className"===n&&(r[n]=[s,a].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props),ref:t?(0,s.F)(t,l):l})}return n.Children.count(r)>1?n.Children.only(null):null});l.displayName="SlotClone";var o=({children:e})=>(0,a.jsx)(a.Fragment,{children:e});function c(e){return n.isValidElement(e)&&e.type===o}},77712:function(e,t,r){"use strict";r.d(t,{j:function(){return a}});let n=e=>"boolean"==typeof e?"".concat(e):0===e?"0":e,s=function(){for(var e,t,r=0,n="";r<arguments.length;)(e=arguments[r++])&&(t=function e(t){var r,n,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t))for(r=0;r<t.length;r++)t[r]&&(n=e(t[r]))&&(s&&(s+=" "),s+=n);else for(r in t)t[r]&&(s&&(s+=" "),s+=r)}return s}(e))&&(n&&(n+=" "),n+=t);return n},a=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:l}=t,o=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],s=null==l?void 0:l[e];if(null===t)return null;let a=n(t)||n(s);return i[e][a]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return s(e,o,null==t?void 0:null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:r,className:n,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...c}[t]):({...l,...c})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[2981,605,2972,2971,2117,1744],function(){return e(e.s=84893)}),_N_E=e.O()}]);